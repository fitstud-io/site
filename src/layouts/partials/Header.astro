---
import Logo from "@/components/Logo.astro";
import Social from "@/components/Social.astro";
import menu from "@/config/menu.json";
import social from "@/config/social.json";
import { IoSearch } from "react-icons/io5";

export interface ChildNavigationLink {
  name: string;
  url: string;
}

export interface NavigationLink {
  name: string;
  url: string;
  hasChildren?: boolean;
  children?: ChildNavigationLink[];
}

const { main }: { main: NavigationLink[] } = menu;
---

<header
  class="header"
  x-data="{ mobileMenuOpen: false }"
>
  <nav class="navbar">

    <!-- logo -->
    <div class="order-0">
      <Logo />
    </div>

    <!-- Navigation for large screens -->
    <div
      class="ml-6 hidden items-center justify-between text-xl md:flex md:space-x-0.5 md:text-base lg:space-x-2"
    >
      {
        main.map((menu) => (
          <>
            {menu.hasChildren ? (
              <ul>
                <li class="nav-item nav-dropdown group relative cursor-pointer">
                  <span class="nav-link inline-flex items-center">
                    {menu.name}
                    <svg class="h-5 w-5 fill-current" viewBox="0 0 20 20">
                      <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                    </svg>
                  </span>
                  <ul class="nav-dropdown-list hidden group-hover:block md:invisible md:absolute md:block md:opacity-0 md:group-hover:visible md:group-hover:opacity-100">
                    {menu.children?.map((child) => (
                      <li class="nav-dropdown-item">
                        <a href={child.url} class="nav-dropdown-link">
                          {child.name}
                        </a>
                      </li>
                    ))}
                  </ul>
                </li>
              </ul>
            ) : (
                <a href={menu.url} class="px-3 py-1 text-md font-medium text-gray-800 transition duration-300 ease-in-out hover:text-red-700">
                  {menu.name}
                </a>
            )}
          </>
        ))
      }
    </div>
    <!-- navbar search -->
    <div class="order-1 ml-auto flex md:order-2 md:ml-0">
      <a
        class="mr-4 inline-block cursor-pointer p-2 text-xl text-dark transition hover:text-primary md:mr-0"
        href="/search"
        title="seach"
        aria-label="seach"
      >
        <IoSearch />
      </a>
    </div>
    <!-- Hamburger menu button -->
    <button
      class="group order-3 relative ml-6 flex cursor-pointer items-center justify-center rounded-xl bg-gray-50 p-3 transition duration-300 ease-in-out hover:bg-gray-100 focus:outline-none md:hidden"
      aria-label="Toggle Navigation"
      @click="mobileMenuOpen = !mobileMenuOpen"
    >
      <span
        class="relative h-3.5 w-4 transform transition duration-500 ease-in-out"
      >
        <span
          class="absolute block h-0.5 rotate-0 transform rounded-full bg-gray-600 opacity-100 transition-all duration-300 ease-in-out group-hover:bg-gray-900"
          :class="mobileMenuOpen ? 'w-0 top-1.5 left-1/2': 'top-0 left-0 w-full'"
        ></span>
        <span
          class="absolute left-0 top-1.5 block h-0.5 w-full transform rounded-full bg-gray-600 opacity-100 transition-all duration-300 ease-in-out group-hover:bg-gray-900"
          :class="mobileMenuOpen ? 'rotate-45': 'rotate-0'"
        ></span>
        <span
          class="absolute left-0 top-1.5 block h-0.5 w-full transform rounded-full bg-gray-600 opacity-100 transition-all duration-300 ease-in-out group-hover:bg-gray-900"
          :class="mobileMenuOpen ? '-rotate-45': 'rotate-0'"
        ></span>
        <span
          class="absolute block h-0.5 rotate-0 transform rounded-full bg-gray-600 opacity-100 transition-all duration-300 ease-in-out group-hover:bg-gray-900"
          :class="mobileMenuOpen ? 'top-1.5 left-1/2 w-0': 'left-0 top-3 w-full'"
        ></span>
      </span>
    </button>
  </div>
</nav>

<!-- Mobile menu -->
<nav
  class="md:hidden bg-white h-screen bg-opacity-85 backdrop-blur-md"
  aria-label="Global"
  id="mobile-menu"
  x-show="mobileMenuOpen"
  @keydown.escape.window="mobileMenuOpen = false"
>
  <div class="space-y-1 px-2 pb-3 pt-2">
    {
      main.map((menu) => (
        <>
          {menu.hasChildren ? (
            <ul>
              <li class="nav-item nav-dropdown group relative cursor-pointer">
                <span class="nav-link inline-flex items-center">
                  {menu.name}
                  <svg class="h-5 w-5 fill-current" viewBox="0 0 20 20">
                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                  </svg>
                </span>
                <ul class="nav-dropdown-list hidden group-hover:block md:invisible md:absolute md:block md:opacity-0 md:group-hover:visible md:group-hover:opacity-100">
                  {menu.children?.map((child) => (
                    <li class="nav-dropdown-item">
                      <a href={child.url} class="nav-dropdown-link">
                        {child.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </li>
            </ul>
          ) : (
              <a href={menu.url} class="nav-link block px-4 py-3 font-medium hover:bg-gray-50">
                {menu.name}
              </a>
          )}
        </>
      ))
    }
  <Social source={social} className="social-icons flex flex-row px-20 min-h-screen justify-center items-center" />
  </div>
</nav>
</header>
